LeoBook Developer Tasks — Updated 2026-02-17


1. LeoBook App (Flutter): 
   STATUS: ✅ IMPLEMENTED (v2.8)
   All UI data is dynamically synced from Supabase. No hardcoded strings, mock data, or placeholder values. 
   Repository pattern: data_repository.dart fetches from Supabase with local caching.
   Responsive layout system via responsive_constants.dart with constraints-based design.
   75% uniform UI scaling via Transform.scale in main.dart builder.

2. Prologue (formerly Chapter 0): Enrichment & Outcome Review
   STATUS: ✅ IMPLEMENTED (v2.8)
   SyncManager.sync_on_startup() handles bi-directional Supabase sync.
   outcome_reviewer.py visits match URLs to extract final scores, reviews W/L/D.
   enrich_all_schedules.py visits all 22k+ match URLs to extract/upsert:
     - teams.csv (team IDs, crests, URLs)
     - region_league.csv (region-league mappings)  
     - schedules.csv (missing datetime, scores, status backfill)
     - standings.csv (league tables)
   Status column in schedules.csv: scheduled/postponed/cancelled/finished.
   Live match detection in Flutter UI: match_date == today AND match_time >= now < (match_time + 2.5h).

3. Chapter 1B: Custom Rule Engine & LeoBook Lite
   STATUS: PLANNED (not yet implemented)
   Offline reprediction (main_offline_repredict) exists in Leo.py via fs_offline.py.
   Custom rule engine creation, storage, backtesting, and accuracy comparison: NOT YET BUILT.
   User account tiers (Lite vs unregistered): NOT YET BUILT.
   Custom predictions visible only to the creating user: NOT YET BUILT.
   Rule documentation and comparison dashboard: NOT YET BUILT.
   
   Existing infrastructure that supports this:
     - rule_engine.py + rule_config.py: supports custom rule definitions
     - learning_engine.py: supports alternative weight matrices  
     - fs_offline.py: supports reprediction without browser
     - Firebase Auth scaffold exists in auth_repository.dart
     - Rule editor UI exists: rule_editor_screen.dart + backtest_dashboard.dart

4. LeoBook Pro:
   STATUS: PLANNED (not yet implemented)
   Full access to Chapters 0-3 (Prologue + Ch1 + Ch2 + Ch3).
   Automated booking + withdrawal management for Pro users.
   Requires: account system (Firebase Auth), subscription management, access control middleware.

   Access Control Matrix:
     - Unregistered:   Prologue (read-only), Ch1-A (default rules), Ch1-C (odds view)
     - LeoBook Lite:   + Ch1-B (custom rules, backtesting, custom predictions)
     - LeoBook Pro:    + Ch2 (automated booking/withdrawal), Ch3 (oversight dashboard)




Notes from February 19, 2026 (3:20 AM Session)

### Development / Bugfix / Feature Notes

**Core data fetching & persistence issues**  
1. Prologue Page should **upsert** the CSV only if the database contains more recent data than the current CSV; otherwise pull from CSV.  
2. The `build_search_dict` function unnecessarily repeats itself by re-querying already-fetched metadata on every restart. It should focus **only** on entries that still need to be filled instead of redoing everything from scratch on each run.

**Processing & feedback problems**  
3. When attempting **ALGO**, no feedback is provided about the attempt status or result. It should give clear feedback (success/failure/partial/etc.).  
4. The process `Enrich_all_Schedule_League_Page=True` always gets **stuck** afterward and never completes. This needs to be fixed.

**UI / Display / Badge logic**  
5. The **persistent "Live" badge** remains visible even when the day's games/matches are completely finished. This should be resolved.  
6. Similar to the live tab streaming logic, the streamer should also handle/stream the **finished** tab (or equivalent), which contains extra info such as:  
   - "Pen" → penalties  
   - "canc" → cancelled match  
   The goal is to use this information to correctly remove the "Live" badge once matches are truly over.

**Scheduled tab improvements**  
7. Update the **Scheduled** tab to properly recognize and display matches marked **FRO – Final Results Only**  
   → Meaning: no livestream is/was available → only final result is shown.

**Refresh & performance**  
8. Increase the refresh time interval of **livescore(s)** to **15 seconds**.

**Flashscore ALL tab handling & fallback logic**  
9. Regarding point 6 above (finished tab):  
   - Switch to using the **ALL** tab of Flashscore instead of the finished tab.  
   - Do **not** display "null" in the UI for postponed/cancelled/FRO matches.  
   - Instead show:  
     - "Postponed" or "Cancelled" or "FRO"  
     - **No live badge** and **no score** — just show "vs" (same as how scheduled matches without result are displayed).  
   - The **2.5 hours** rule **no longer applies** to these cases.  
   - In fact, the **2.5 hours** logic has been **deprecated** throughout the entire codebase.  
   - We no longer rely on the "ALL" tab of Flashscore for primary data — stream parsers now provide those updates.  
   - The 2.5-hour fallback is **only** used when the streamer fails or is not streaming.

**Flashscore module critical bug**  
10. In `flashscore_module_manager.py`, the function `extract_matches_from_page` is **not defined anywhere** (neither in the Page class nor elsewhere).  
    → This is causing **no schedule extraction** to happen at all.


